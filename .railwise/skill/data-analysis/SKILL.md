---
name: data-analysis
description: 测绘数据平差与变形分析专业技能包。当处理控制网平差、变形趋势分析或数据异常判断时加载此技能。
---

## 适用场景

- 水准网、导线网平差计算流程指导
- 地铁结构长期变形时序数据分析
- 自动化监测数据清洗与趋势判读
- 变形速率计算与收敛性判断

## 平差计算标准流程

### 水准网平差

1. 数据检查：核对测段数量与检定书中路线设计一致
2. 闭合差计算：调用 `check_leveling_closure` 工具，严禁口算
3. 权的确定：按测段长度定权（$p_i = C / L_i$，C 为常数）
4. 法方程建立：$N_{bb} \hat{x} = W$
5. 求解平差值：$\hat{x} = N_{bb}^{-1} W$
6. 精度评定：单位权中误差 $\hat{\sigma}_0 = \sqrt{V^T P V / (n-t)}$
7. 点位精度：$\sigma_i = \hat{\sigma}_0 \sqrt{Q_{ii}}$（$Q_{ii}$ 为协因数阵对角元素）

### 导线网平差

1. 角度闭合差检核：调用 `check_traverse_angular` 工具
2. 坐标闭合差计算：$f_x$, $f_y$
3. 全长相对闭合差：$f_s / \Sigma s$（四等导线≤1/40000）
4. 近似坐标计算 → 法方程建立 → 严密平差

## 变形分析方法论

### 单测次数据处理

| 步骤 | 方法 | 判断标准 |
|-----|------|---------|
| 粗差检验 | 莱特准则（$3\sigma$）或格拉布斯准则 | $|v_i| > 3\sigma$ 为粗差 |
| 系统误差 | 对比不同时段仪器的读数漂移规律 | 趋势线斜率持续单向 |
| 相关性验证 | 相邻测点变形是否呈连续分布 | 孤立异常点须重测确认 |

### 时序数据趋势分析

- **线性趋势**：$y = kt + b$，$k$ 为变形速率（mm/d）
- **指数衰减**：$y = A \cdot e^{-\lambda t} + C$（适用于固结沉降后期）
- **拐点识别**：当速率 $k_n > 1.5 \times \bar{k}_{前期}$ 时，判定为加速阶段，触发预警

### 收敛性判断标准

满足以下条件可判定变形趋于稳定：
- 连续30天日变化量 ≤ 0.1mm
- 速率曲线斜率接近0（|k| < 0.05mm/d）
- 累计变化量达到渐近线（拟合误差 < 5%）

## 预警分级体系

```
绿色（正常）：累计变化量 < 控制值70%，速率 < 1mm/d
黄色（提示）：累计变化量 70%~85%，速率 1~2mm/d
橙色（预警）：累计变化量 85%~100%，速率 2~3mm/d
红色（报警）：累计变化量 ≥ 控制值100%，或速率 > 3mm/d
```

## CSV 数据处理规范

- **禁止**：将原始 CSV 文件内容直接塞给 LLM 分析
- **正确做法**：调用 `analyze_monitoring_csv` 工具处理，获取浓缩 JSON 后再解读
- 工具会自动执行：MAD 粗差剔除 → 核心指标计算 → 超限标记
- AI 的职责是：基于工具返回的结果，给出**工程判断和结论建议**

## 报告数据呈现规范

| 要求 | 说明 |
|-----|------|
| 有效数字 | 变化量保留至小数点后1位（mm），速率保留2位 |
| 表格形式 | 所有测点数据必须表格呈现，禁止列举 |
| 单位统一 | 全文统一使用 mm，不与 m 混用 |
| 超限标注 | 超限数据使用 **加粗** + ⚠️ 标注 |
| 基准说明 | 明确注明基准期及基准值获取方式 |
